# 🍀 동행복권 자동 구매 & 통계 관리 시스템 (CLI)

이 프로젝트는 동행복권 사이트(dhlottery.co.kr)에 접속하여 **로또 6/45 및 연금복권 720+를 자동으로 구매**하고, 케이뱅크 간편결제를 통해 **예치금을 자동 충전**하며, 평생 **당첨 이력과 통계를 로컬 DB로 관리**할 수 있는 파이썬(Python) 기반의 완전 자동화 CLI 도구입니다.

`Playwright`를 이용한 Headless 브라우저 방식으로 동작하여 터미널 환경이나 서버(Crontab 등) 환경에서도 완벽히 백그라운드로 실행 가능합니다.

---

## 🌟 주요 제공 기능

1. **복권 구매 자동화**
   - 로또 6/45 자동 구매 (1~5게임 원하는 만큼)
   - 로또 6/45 수동 구매 (원하는 6개 번호 직접 입력 가능)
   - 연금복권 720+ 세트 구매 (모든 조 자동 세트 단위로 구매)
2. **케이뱅크 간편결제 자동 충전**
   - 브라우저 상의 보안 키패드(가상 키보드)를 Tesseract OCR (광학 문자 인식)를 이용해 시각적으로 분석 후 간편 비밀번호 자동 입력. (금액: 1,000원 ~ 50,000원 단위 자유 설정)
3. **로컬 DB 기반 완벽한 통계 및 성적표**
   - **`SQLite`** 데이터베이스 연동. 구입한 티켓을 내 로컬에 저장하고 매주 당첨결과 채점.
   - 🎯 **새로운 결과 알리미**: 추첨이 끝났으나 아직 내가 열어보지 않은(미확인) 결과만 쏙쏙 뽑아서 얼마가 당첨됐는지 알려줍니다.
   - 📊 **평생 누적 성적표**: 지금까지 이 프로그램을 통해 사용한 모든 지출액, 누적 당첨금, 랭크(1등~5등) 횟수 및 **종합 순수익(Net Profit)** 을 산출합니다.

---

## 💻 시스템 요구 사항 (Pre-requisites)

이 프로그램을 실행하기 위해서는 아래의 환결 설정이 필요합니다. Windows, macOS, Linux 무관하게 아래 3가지가 필수입니다.

1. **Python 3.10 이상**
2. **Tesseract OCR 엔진 설치 (필수)**
   - 케이뱅크 가상 키보드 이미지 해독용. 환경변수까지 등록되어야 합니다.
   - 설치 방법은 [`docs/TESSERACT_GUIDE.md`](docs/TESSERACT_GUIDE.md) 문서를 참고해 주세요.
3. **동행복권 계정 및 케이뱅크 간편결제 연동 상태**
   - 동행복권 홈페이지에서 케이뱅크 간편결제가 이미 등록되어 비밀번호 6자리만 누르면 충전이 가능한 상태여야 합니다.

---

## 🚀 설치 및 초기 설정 (Setup Guide)

처음 시작하는 사용자(또는 AI 봇)를 위한 0부터 100까지의 실행 단계입니다.

### 1단계: 프로젝트 클론 및 패키지 설치
터미널을 열고 다음 명령어들을 순서대로 입력합니다.

```bash
# 1. 저장소 다운로드 및 프로젝트 폴더 이동
git clone <repository-url>
cd lottery

# 2. 파이썬 가상환경(venv) 생성 및 활성화 (강력 권장)
# [Mac / Linux]
python3 -m venv venv
source venv/bin/activate
# [Windows]
python -m venv venv
venv\Scripts\activate

# 3. 필수 패키지 설치
pip install -r requirements.txt

# 4. Playwright (Headless 브라우저) 설치
playwright install chromium
```

### 2단계: 환경 변수 세팅 (`.env` 파일 구성)
프로젝트 최상단 디렉터리에 `.env` 파일을 만들고 아래 내용을 본인의 정보로 채워 넣습니다.
(`cp .env.sample .env` 명령어로 복사해서 사용 가능)

```env
# 동행복권 홈페이지 로그인 정보
DHLOTTERY_ID=본인아이디
DHLOTTERY_PW=본인비밀번호

# 예치금 충전을 위한 케이뱅크 간편결제 비밀번호 6자리
CHARGE_PIN=123456

# (선택 사항) 결과 알림봇 설정 - 미입력 시 작동 해제
DISCORD_WEBHOOK_URL=
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=
```

---

## 🛠️ 모든 CLI 명령어 사용 가이드 (How to Use)

모든 작업은 가상환경이 활성화된 터미널에서 `python main.py [명령어]` 형식으로 실행합니다.

### 💰 조회 및 충전
```bash
# 동행복권 현재 내 잔고(예치금) 조회
python main.py balance
> [출력 예시] 현재 예치금: 13,000원

# 케이뱅크 간편결제로 예치금 충전 (Tesseract OCR 작동)
# 기본 10,000원이 충전되며, --amount 를 통해 1,000~50,000원 사이 지정 가능
python main.py charge --amount 20000
> [출력 예시] 💳 간편충전 완료: 20,000원 예치금 충전이 성공적으로 끝났습니다.
```

### 🎫 복권 구매
```bash
# 로또 자동 구매 (기본 1게임, 최대 5게임 지정 가능)
python main.py buy --amount 5
> [출력 예시] ✅ 성공적으로 로또 6/45 자동 5게임을 구매했습니다!

# 로또 수동 번호 구매 (콤마나 공백으로 6개 숫자 나열)
python main.py buy --manual "7, 13, 22, 31, 38, 45"
> [출력 예시] ✅ 성공적으로 수동 번호 [7, 13, 22, 31, 38, 45] 1게임을 구매했습니다!

# 연금복권 720+ 프리미엄 세트 구매 (자동 번호 5게임 세트)
python main.py buy720
> [출력 예시] ✅ 성공적으로 연금복권 720+ (1세트, 5게임)을 구매했습니다!
```

### 📊 당첨 확인 및 내 생애 로또 통계 (DB 연동)

이 시스템의 가장 핵심적인 기능입니다. 당신의 뼈아픈 과거 지출과 영광의 당첨금이 모두 기록됩니다. **반드시 매주 일요일/월요일에 `python main.py update`를 먼저 실행**해야 DB가 최신 번호로 채점됩니다.

```bash
# 1. 시스템 정보 갱신 (스크래퍼 봇이 동행복권 사이트에서 최신 당첨 번호를 가져와 내 티켓을 채점)
python main.py update
> 총 5건의 게임 결과가 업데이트 되었습니다.

# 2. 미확인 새로운 결과 까보기 👀
# "내가 산 티켓 중 추첨은 끝났는데 내가 아직 결과를 안 본 티켓" 만 모아서 보여줍니다.
python main.py check-pending
```
**`check-pending` 결과물 예시:** 
*(조회하는 즉시 시스템이 '확인 완료' 상태로 세팅하므로, 두 번 연속 치면 0건으로 나옵니다)*
```text
[알림] 확인하지 않은 새로운 추첨 결과가 있습니다!
==================================================
  🎁 새로 확인된 로또 추첨 결과 🎁
==================================================
  • 확인된 게임 수     :            5 게임
  • 소모 비용          :        5,000 원
--------------------------------------------------
  • 총 당첨금 합계     :   50,000,000 원
==================================================
[상세 당첨 내역]
  🥇 1등 :          0 번
  🥈 2등 :          0 번
  🥉 3등 :          1 번  (🎉 축하합니다!)
  ... (생략)
```

```bash
# 3. 내 생애 누적 총 통계 실적 보기
# 내가 이 프로그램을 통해 구매했던 '모든' 역대 내역의 총 영수증입니다.
python main.py stats
```
**`stats` 결과물 예시:**
```text
==================================================
            📊 나의 로또 생애 누적 통계 📊
==================================================
  [누적 금액 현황]
  +-----------------------+------------------------+
  | 역대 누적 지출금      |              150,000 원 |
  | 역대 누적 당첨금      |           50,015,000 원 |
  +-----------------------+------------------------+
  | 💰 종합 순수익금      | +         49,865,000 원 |
  +-----------------------+------------------------+
  [역대 당첨 랭크 누적]
  Total Played: 150 Games
  - 1등 : 0회  |  2등 : 0회  |  3등 : 1회 ... (생략)
```

---

## 💡 자동화 (Crontab) 사용 팁
리눅스 체제나 Mac의 경우 `crontab` 에 아래와 같이 명령어를 등록해두면 매주 금요일 자동으로 돈을 충전하고 자동으로 로또를 사고, 월요일에 알아서 당첨금을 갱신하도록 구성할 수 있습니다. 

> **주의**: 너무 짧은 주기(예: 매 분마다)의 실행은 동행복권 측에 트래픽을 유발하여 세션 밴을 당할 수 있으니 위클리(Weekly) 단위 설정을 권장합니다.

```bash
# 매주 금요일 오전 9시에 남은 잔액과 무관하게 1만원 충전 후, 로또 자동 5게임 구입
0 9 * * 5 cd /projects/lottery && source venv/bin/activate && python main.py charge --amount 10000 && python main.py buy --amount 5

# 매주 일요일 오전 10시에 당첨DB 업데이트 및 채점
0 10 * * 7 cd /projects/lottery && source venv/bin/activate && python main.py update
```

## 라이선스
MIT 라이선스 하에 배포됩니다.
